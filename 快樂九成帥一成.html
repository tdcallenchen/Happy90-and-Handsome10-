<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>快樂九成帥一成team</title>
<style>
:root {
  --bg1: #fff5f7;
  --bg2: #ffd7e0;
  --accent: #e25b77;
  --dark: #444;
  --light: #fff;
  --male: #5b9bd5;
  --female: #f4a6c1;
  --winner: #3cb371;
}
body { font-family:'Segoe UI',sans-serif; font-size:16px; margin:0; padding:20px; background:linear-gradient(135deg,var(--bg1),var(--bg2)); display:flex; flex-direction:column; align-items:center; color:var(--dark); }
h1 { display:flex; align-items:center; justify-content:center; gap:10px; cursor:pointer; text-align:center; color:var(--accent); font-size:28px; font-weight:bold; margin-bottom:15px; }
h1 .logo { height:8vw; max-height:100px; min-height:60px; width:auto; }
#controls { text-align:center; margin:15px 0; }
#newPlayer { padding:8px 14px; width:180px; border:1px solid var(--accent); border-radius:6px; font-size:15px; }
select { padding:8px; border-radius:6px; border:1px solid var(--accent); font-size:15px; }
button { font-size:15px; padding:10px 16px; margin-left:6px; border:none; border-radius:12px; background-color:var(--accent); color:var(--light); cursor:pointer; font-weight:bold; transition:0.3s; }
button:hover { background-color:#d64a6a; }
.delete-mode-btn.active { background-color:#c63f55 !important; }

.container { display:flex; justify-content:center; align-items:flex-start; gap:20px; width:95%; max-width:1600px; }
.right-side { display:flex; flex-direction:column; gap:20px; flex:2; }
.courts { display:flex; gap:20px; }
.waiting { display:flex; gap:20px; }
.area { flex:1; background:var(--light); border:2px solid var(--accent); border-radius:20px; padding:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); display:flex; flex-direction:column; height:450px; min-width:220px; }
.area h3 { text-align:center; color:var(--accent); margin:8px 0; font-size:18px; font-weight:bold; }
.player-zone { flex-grow:1; overflow-y:auto; }
#bench { flex:1; max-width:260px; height:945px; }
.player { position:relative; padding:10px 12px 10px 32px; margin:8px 0; border:2px solid var(--accent); border-radius:14px; font-size:16px; font-weight:bold; display:flex; align-items:center; justify-content:flex-start; transition:0.2s; cursor:pointer; color:#fff; }
.player-name { flex-grow:1; text-align:center; }
.player.winner { background:var(--winner) !important; border-color:var(--winner) !important; }
.player .delete-x { display:none; position:absolute; left:6px; top:50%; transform:translateY(-50%); width:20px; height:20px; border:none; background:transparent; color:#c63f55; font-size:18px; font-weight:bold; cursor:pointer; opacity:0.8; padding:0; }
.player.delete-mode .delete-x { display:block; }
.area-controls { text-align:center; margin-top:6px; }
#adminControls { text-align:center; margin:10px; display:none; }

@media (max-width:768px){
  h1 { font-size:22px; }
  .area h3 { font-size:16px; }
  .container { flex-direction:column; align-items:stretch; }
  .right-side { flex-direction:column; }
  .courts, .waiting { flex-direction:column; }
  #bench { max-width:100%; width:100%; height:auto; }
  .area { height:auto; }
  .player { font-size:15px; padding:8px 10px 8px 28px; }
  button { font-size:14px; padding:8px 14px; }
}
</style>
</head>
<body>
<h1 id="title"><img src="logo.png" class="logo" alt="logo">快樂九成帥一成team</h1>

<div id="controls">
  <input type="text" id="newPlayer" placeholder="輸入球員名稱">
  <select id="gender"><option value="M">男</option><option value="F">女</option></select>
  <button onclick="addPlayer()">新增球員</button>
  <button id="randomBtn">隨機分組</button>
  <button id="resetBtn">重置</button>
  <button id="deleteModeBtn" class="delete-mode-btn">刪除球員</button>
</div>

<div id="adminControls"><button id="showScoreBtn">查看排行榜</button></div>

<div class="container">
  <div class="area" id="bench"><h3>休息區</h3><div class="player-zone" id="bench-zone"></div></div>
  <div class="right-side">
    <div class="courts">
      <div class="area" id="court1"><h3>5號場</h3><div class="player-zone" id="court1-zone"></div><div class="area-controls"><button onclick="endMatch('court1')">結束比賽</button></div></div>
      <div class="area" id="court2"><h3>6號場</h3><div class="player-zone" id="court2-zone"></div><div class="area-controls"><button onclick="endMatch('court2')">結束比賽</button></div></div>
    </div>
    <div class="waiting">
      <div class="area" id="waitingA"><h3>等待順位1</h3><div class="player-zone" id="waitingA-zone"></div></div>
      <div class="area" id="waitingB"><h3>等待順位2</h3><div class="player-zone" id="waitingB-zone"></div></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
const areaIds = ['bench-zone','court1-zone','court2-zone','waitingA-zone','waitingB-zone'];
let deleteMode=false;
const playerData={};

// 新增球員
function addPlayer(){
  const name=document.getElementById('newPlayer').value.trim();
  const gender=document.getElementById('gender').value;
  if(!name) return;
  if(!playerData[name]) playerData[name]={score:500, gender, winStreak:0};
  const div=document.createElement('div'); 
  div.className='player'; 
  div.dataset.name=name; 
  div.dataset.gender=gender;
  div.style.background=gender==='M'?'var(--male)':'var(--female)';
  const span=document.createElement('span'); 
  span.className='player-name'; 
  span.textContent=name; 
  div.appendChild(span);
  document.getElementById('bench-zone').appendChild(div);
  document.getElementById('newPlayer').value=''; 
  updateDeleteUI();
}

// 刪除模式
function updateDeleteUI(){
  areaIds.forEach(id=>{
    document.querySelectorAll(`#${id} .player`).forEach(div=>{
      div.classList.toggle('delete-mode', deleteMode);
      if(deleteMode && !div.querySelector('.delete-x')){
        const btn=document.createElement('button'); btn.className='delete-x'; btn.textContent='✕';
        btn.onclick=e=>{ e.stopPropagation(); delete playerData[div.dataset.name]; div.remove(); };
        div.insertBefore(btn, div.firstChild);
      } else if(!deleteMode){
        const btn=div.querySelector('.delete-x'); if(btn) btn.remove();
      }
    });
  });
}

document.getElementById('deleteModeBtn').addEventListener('click',()=>{
  deleteMode=!deleteMode;
  document.getElementById('deleteModeBtn').classList.toggle('active',deleteMode);
  document.getElementById('deleteModeBtn').textContent=deleteMode?'結束刪除':'刪除球員';
  updateDeleteUI();
});

// 拖曳初始化
areaIds.forEach(id=>{
  Sortable.create(document.getElementById(id),{
    group:{name:'players', pull:true, put:true},
    animation:150,
    onMove:(evt)=>{
      const targetId = evt.to.id;
      if(targetId!=='bench-zone' && evt.to.children.length>=4) return false;
    }
  });
});

// 隨機分組
document.getElementById('randomBtn').addEventListener('click',()=>{
  const bench=[...document.querySelectorAll('#bench-zone .player')];
  bench.sort((a,b)=>playerData[b.dataset.name].score-playerData[a.dataset.name].score);
  const court1=document.getElementById('court1-zone'), court2=document.getElementById('court2-zone');
  const waitingA=document.getElementById('waitingA-zone'), waitingB=document.getElementById('waitingB-zone');
  [court1,court2,waitingA,waitingB].forEach(z=>{
    while(z.children.length>0) document.getElementById('bench-zone').appendChild(z.children[0]);
  });
  bench.forEach(p=>{
    if(court1.children.length<4) court1.appendChild(p);
    else if(court2.children.length<4) court2.appendChild(p);
    else if(waitingA.children.length<4) waitingA.appendChild(p);
    else waitingB.appendChild(p);
  });
  updateDeleteUI();
});

// 查看排行榜
document.getElementById('showScoreBtn').addEventListener('click',()=>{
  const list=Object.entries(playerData).map(([name,d])=>`${name}: ${d.score}`).join('\n');
  alert("分數排行榜：\n"+list);
});

// 隱藏按鈕: 標題三擊
let clickCount=0;
document.getElementById('title').addEventListener('click',()=>{
  clickCount++;
  if(clickCount>=3){
    const admin=document.getElementById('adminControls');
    admin.style.display=admin.style.display==='none'?'block':'none';
    clickCount=0;
  }
  setTimeout(()=>clickCount=0,1200);
});

// 重置
document.getElementById('resetBtn').addEventListener('click',()=>{
  if(confirm('確認清空所有區域?')){
    areaIds.forEach(id=>document.getElementById(id).innerHTML=''); 
    for(let k in playerData) delete playerData[k];
  }
});

// 點選球員標記贏家
['court1-zone','court2-zone'].forEach(courtId=>{
  document.getElementById(courtId).addEventListener('click', e=>{
    if(!e.target.classList.contains('player-name')) return;
    const playerDiv=e.target.parentElement;
    playerDiv.classList.toggle('winner');
  });
});

// 結束比賽
function endMatch(courtId){
  const courtZone=document.getElementById(`${courtId}-zone`);
  const bench=document.getElementById('bench-zone');
  const waitingA=document.getElementById('waitingA-zone');
  const waitingB=document.getElementById('waitingB-zone');
  if(courtZone.children.length===0) return;

  const winners=[...courtZone.querySelectorAll('.player.winner')].map(p=>p.dataset.name);
  if(winners.length===0){ alert('請先點選贏家再結束比賽'); return; }

  courtZone.querySelectorAll('.player').forEach(p=>{
    const name=p.dataset.name;
    const gender=p.dataset.gender;
    if(winners.includes(name)){
      playerData[name].score += 20;
      playerData[name].winStreak = (playerData[name].winStreak || 0)+1;
    } else {
      const opponents = [...courtZone.querySelectorAll('.player')].filter(x=>winners.includes(x.dataset.name));
      const oppStreak = Math.max(...opponents.map(x=>playerData[x.dataset.name].winStreak || 0));
      const lossPts = (gender==='M'?15:10) + oppStreak*5;
      playerData[name].score -= lossPts;
      playerData[name].winStreak = 0;
    }
    p.classList.remove('winner');
    bench.appendChild(p);
    p.style.background=gender==='M'?'var(--male)':'var(--female)';
  });
  updateDeleteUI();

  // 補場地
  [courtZone].forEach(court=>{
    while(court.children.length<4 && waitingA.children.length>0){
      court.appendChild(waitingA.children[0]);
    }
  });
  // 補等待順位1
  while(waitingA.children.length<4 && waitingB.children.length>0){
    waitingA.appendChild(waitingB.children[0]);
  }
}
</script>
</body>
</html>
